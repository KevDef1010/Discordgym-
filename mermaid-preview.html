<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiscordGym Architektur Diagramme</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .mermaid {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>üèóÔ∏è DiscordGym - System Architektur</h1>
    
    <div class="diagram-container">
        <h2>üìä Erweiterte Systemarchitektur</h2>
        <div class="mermaid">
            graph TB
                subgraph "Frontend (Angular 20)"
                    A[Browser Client<br/>app.your-domain.com]
                    B[Auth Service]
                    C[Dashboard]
                    D[Login/Register]
                    E[Route Guards]
                    N[Socket.IO Client]
                end
                
                subgraph "Load Balancer & Reverse Proxy"
                    T[NGINX]
                    U[SSL/TLS Termination]
                    W[Rate Limiting]
                    X[Static Content Cache]
                end
                
                subgraph "Backend (NestJS)"
                    F[API Server<br/>api.your-domain.com]
                    G[Auth Controller]
                    H[User Controller]
                    I[Workout Controller]
                    J[Auth Service<br/>JWT & Security]
                    O[WebSocket Gateway]
                    P[Friends Gateway]
                    Q[Chat Gateway]
                end
                
                subgraph "Cache & Session Layer"
                    R[Redis<br/>Primary]
                    S[Redis<br/>Replica]
                    AA[Socket.IO State]
                    AB[Session Storage]
                    AC[Message Queue]
                    AD[Rate Limiting Data]
                end
                
                subgraph "Database"
                    K[MariaDB<br/>Primary]
                    Y[MariaDB<br/>Replica]
                    L[Prisma ORM]
                    M[Prisma Studio<br/>Development Only]
                end

                subgraph "Security Layer"
                    V[Auth Guards]
                    Z[JWT Validation]
                    ZA[API Gateway]
                end
                
                %% Client connections
                A --> T
                
                %% NGINX handling
                T --> U
                T --> W
                T --> X
                T --> F
                T --> O
                
                %% Frontend service connections
                B --> G
                C --> H
                D --> G
                E --> B
                N --> O
                
                %% Backend service connections
                G --> J
                H --> L
                I --> L
                J --> L
                F --> V
                V --> Z
                
                %% WebSocket connections
                O --> R
                P --> R
                Q --> R
                
                %% Redis connections
                R --> S
                R --> AA
                R --> AB
                R --> AC
                R --> AD
                W --> AD
                
                %% Database connections
                L --> K
                K --> Y
                M --> K
                
                style A fill:#e1f5fe
                style F fill:#f3e5f5
                style K fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
                style Y fill:#e8f5e8,stroke-dasharray:5 5
                style R fill:#fff8e1,stroke:#ff6f00,stroke-width:2px
                style S fill:#fff8e1,stroke-dasharray:5 5
                style T fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
                style O fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
        </div>
    </div>

    <div class="diagram-container">
        <h2>üöÄ Deployment und Skalierung</h2>
        <div class="mermaid">
            flowchart TB
                subgraph "Production Environment"
                    subgraph "Load Balancer Tier"
                        LB1[NGINX Primary]
                        LB2[NGINX Secondary]
                    end
                    
                    subgraph "Web Application Tier"
                        A1[Angular Instance 1]
                        A2[Angular Instance 2]
                        A3[Angular Instance n]
                    end
                    
                    subgraph "API Tier"
                        N1[NestJS Instance 1]
                        N2[NestJS Instance 2]
                        N3[NestJS Instance n]
                    end
                    
                    subgraph "Cache Tier"
                        R1[Redis Master]
                        R2[Redis Replica 1]
                        R3[Redis Replica 2]
                        RS[Redis Sentinel]
                    end
                    
                    subgraph "Database Tier"
                        DB1[MariaDB Master]
                        DB2[MariaDB Slave]
                    end
                end
                
                Client1[Web Clients] --> LB1 & LB2
                Mobile[Mobile Clients] --> LB1 & LB2
                
                LB1 & LB2 --> A1 & A2 & A3
                LB1 & LB2 --> N1 & N2 & N3
                
                A1 & A2 & A3 --> N1 & N2 & N3
                
                N1 & N2 & N3 --> R1
                R1 --> R2 & R3
                RS --> R1 & R2 & R3
                
                N1 & N2 & N3 --> DB1
                DB1 --> DB2
                
                style LB1 fill:#c5cae9,stroke:#3f51b5,stroke-width:2px
                style LB2 fill:#c5cae9,stroke:#3f51b5,stroke-width:1px,stroke-dasharray:5 5
                style A1 fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
                style N1 fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
                style R1 fill:#fff8e1,stroke:#ff6f00,stroke-width:2px
                style DB1 fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                fontFamily: 'Arial, sans-serif',
                fontSize: '14px'
            }
        });
    </script>
</body>
</html>
