<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="bg-white shadow rounded-lg mb-6">
      <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center space-x-4">
          <div class="relative">
            <img 
              [src]="currentUser?.avatar || '/monster_icon.jpg'" 
              [alt]="currentUser?.username"
              class="h-16 w-16 rounded-full object-cover border-4 border-purple-400"
            >
            <!-- Online Status Indicator -->
            <div class="absolute -bottom-1 -right-1 w-5 h-5 rounded-full border-2 border-white"
                 [ngClass]="getStatusDotClass(currentUserStatus)">
            </div>
          </div>
          <div class="flex-1">
            <h1 class="text-2xl font-bold text-gray-900">Profil bearbeiten</h1>
            <p class="text-gray-600">Verwalten Sie Ihre pers√∂nlichen Informationen</p>
            <!-- Current Status Display -->
            <div class="flex items-center mt-2">
              <span class="w-2 h-2 rounded-full mr-2" [ngClass]="getStatusDotClass(currentUserStatus)"></span>
              <span class="text-sm text-gray-500">{{ getStatusText(currentUserStatus) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Success/Error Messages -->
    <div *ngIf="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
      {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
      {{ errorMessage }}
    </div>

    <!-- Profile Form -->
    <div class="bg-white shadow rounded-lg">
      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="px-6 py-4 space-y-6">
        
        <!-- Username -->
        <div>
          <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
            Benutzername
          </label>
          <input
            type="text"
            id="username"
            formControlName="username"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
            placeholder="Ihr Benutzername"
          >
          <div *ngIf="profileForm.get('username')?.invalid && profileForm.get('username')?.touched" 
               class="text-red-600 text-sm mt-1">
            Benutzername ist erforderlich (mindestens 3 Zeichen)
          </div>
        </div>

        <!-- Email -->
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
            E-Mail-Adresse
          </label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
            placeholder="ihre.email@beispiel.com"
          >
          <div *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" 
               class="text-red-600 text-sm mt-1">
            G√ºltige E-Mail-Adresse erforderlich
          </div>
        </div>

        <!-- Discord ID -->
        <div>
          <label for="discordId" class="block text-sm font-medium text-gray-700 mb-2">
            Discord ID
          </label>
          <input
            type="text"
            id="discordId"
            formControlName="discordId"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
            placeholder="Ihre Discord ID"
          >
          <div *ngIf="profileForm.get('discordId')?.invalid && profileForm.get('discordId')?.touched" 
               class="text-red-600 text-sm mt-1">
            Discord ID ist erforderlich
          </div>
        </div>

        <!-- Avatar URL -->
        <div>
          <label for="avatar" class="block text-sm font-medium text-gray-700 mb-2">
            Profilbild URL (optional)
          </label>
          <input
            type="url"
            id="avatar"
            formControlName="avatar"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
            placeholder="https://beispiel.com/ihr-profilbild.jpg"
          >
        </div>

        <!-- User Role (Read-only) -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Rolle
          </label>
          <div class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-600">
            {{ currentUser?.role || 'MEMBER' }}
          </div>
          <p class="text-sm text-gray-500 mt-1">
            Rollen k√∂nnen nur von Administratoren ge√§ndert werden
          </p>
        </div>

        <!-- Online Status -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Online Status
          </label>
          <div class="grid grid-cols-2 gap-3">
            <button
              *ngFor="let status of availableStatuses"
              type="button"
              (click)="changeUserStatus(status.value)"
              class="flex items-center justify-center px-4 py-3 border rounded-md transition-colors duration-200"
              [class]="currentUserStatus === status.value 
                ? 'border-purple-500 bg-purple-50 text-purple-700' 
                : 'border-gray-300 hover:border-gray-400 hover:bg-gray-50'"
            >
              <span class="w-3 h-3 rounded-full mr-2" [ngClass]="getStatusDotClass(status.value)"></span>
              {{ status.label }}
            </button>
          </div>
          <p class="text-sm text-gray-500 mt-1">
            Ihr aktueller Status: <strong>{{ getStatusText(currentUserStatus) }}</strong>
          </p>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-between pt-6 border-t border-gray-200">
          <div class="flex space-x-3">
            <app-button 
              type="submit"
              variant="primary" 
              size="medium"
              [disabled]="profileForm.invalid || isLoading">
              <span *ngIf="isLoading">Speichern...</span>
              <span *ngIf="!isLoading">√Ñnderungen speichern</span>
            </app-button>
            
            <app-button 
              type="button"
              variant="outline" 
              size="medium"
              (click)="onCancel()">
              Abbrechen
            </app-button>
          </div>

          <div class="flex space-x-3">
            <app-button 
              type="button"
              variant="danger" 
              size="medium"
              (click)="onDeleteAccount()">
              Konto l√∂schen
            </app-button>
            
            <app-button 
              type="button"
              variant="secondary" 
              size="medium"
              (click)="startChat()">
              üí¨ Chat starten
            </app-button>
          </div>
        </div>

      </form>
    </div>

    <!-- Server Invitations Section -->
    <div class="bg-white shadow rounded-lg mt-6">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-900">Server-Einladungen</h2>
        <p class="text-gray-600">Verwaltung Ihrer empfangenen Server-Einladungen</p>
      </div>
      
      <div class="px-6 py-4">
        <div *ngIf="invitesLoading" class="text-center py-4">
          <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"></div>
          <span class="ml-2 text-gray-600">Einladungen werden geladen...</span>
        </div>

        <div *ngIf="!invitesLoading && userInvites.length === 0" class="text-center py-8 text-gray-500">
          <div class="text-4xl mb-2">üì®</div>
          <p>Keine Server-Einladungen vorhanden</p>
          <p class="text-sm">Sie erhalten hier Benachrichtigungen √ºber neue Server-Einladungen</p>
        </div>

        <div *ngIf="!invitesLoading && userInvites.length > 0" class="space-y-4">
          <div *ngFor="let invite of userInvites" 
               class="bg-gray-50 border border-gray-200 rounded-lg p-4 hover:bg-gray-100 transition-colors">
            
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <h3 class="font-medium text-gray-900">{{ invite.chatServer?.name || 'Unbekannter Server' }}</h3>
                <p class="text-sm text-gray-600 mt-1">
                  Eingeladen von: {{ invite.createdBy?.username || 'Unbekannt' }}
                </p>
                <p class="text-xs text-gray-500 mt-1">
                  Einladungscode: {{ invite.code }}
                </p>
                <p class="text-xs text-gray-500">
                  L√§uft ab: {{ invite.expiresAt | date:'dd.MM.yyyy HH:mm' }}
                </p>
              </div>
              
              <div class="flex space-x-2 ml-4">
                <button 
                  (click)="acceptInvite(invite.code)"
                  class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                  Beitreten
                </button>
                <button 
                  (click)="declineInvite(invite.id)"
                  class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                  Ablehnen
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Info -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-6">
      <div class="flex items-start">
        <div class="text-blue-600 text-xl mr-3">‚ÑπÔ∏è</div>
        <div>
          <h3 class="text-blue-800 font-medium">Hinweise</h3>
          <ul class="text-blue-700 text-sm mt-1 space-y-1">
            <li>‚Ä¢ Ihre Discord ID wird f√ºr die Integration mit unserem Discord Server verwendet</li>
            <li>‚Ä¢ Das Profilbild wird in der Navbar und im Chat angezeigt</li>
            <li>‚Ä¢ Bei Problemen kontaktieren Sie einen Administrator</li>
          </ul>
        </div>
      </div>
    </div>

  </div>
</div>
